# Часто задаваемые вопросы (FAQ)

## Общие вопросы

### Q: Что делает этот патч?

**A:** Патч удаляет систему проверки лицензионных ключей из Android-приложения с XDSDK. После патчинга:
- Приложение запускается без экрана ввода лицензии
- Не выполняются запросы к серверу проверки лицензий
- Сохраняется функциональность автообновлений
- Все ассеты и библиотеки продолжают работать

### Q: Это безопасно?

**A:** С технической точки зрения - да, патч не содержит вредоносного кода. Однако:
- Используйте только на собственных приложениях
- Не распространяйте пропатченные версии чужих приложений
- Убедитесь, что у вас есть права на модификацию

### Q: Нужен ли root для использования?

**A:** Нет, root не требуется. Пропатченный APK устанавливается как обычное приложение.

### Q: Будут ли работать автообновления?

**A:** Да, система автообновлений сохраняется. Метод `update()` не затрагивается патчем.

## Технические вопросы

### Q: Почему патч затрагивает native библиотеку?

**A:** Проверки лицензии реализованы на нативном уровне (C/C++) в библиотеке `libclient.so`. Это сделано для усложнения реверс-инжиниринга. Патч заставляет функции проверки возвращать `true` без выполнения реальных проверок.

### Q: Что такое ARM64 и почему важна архитектура?

**A:** ARM64 (aarch64) - это 64-битная архитектура процессоров, используемая в современных Android устройствах. Патч работает только для ARM64, потому что:
- Инструкции процессора специфичны для архитектуры
- Большинство современных устройств используют ARM64
- Для ARM32 (armeabi-v7a) потребуются другие инструкции

### Q: Можно ли пропатчить только Smali без изменения .so?

**A:** Теоретически да, но:
- Smali вызывает нативные методы через JNI
- Если native библиотека не пропатчена, проверки все равно выполнятся
- Рекомендуется патчить оба уровня для надежности

### Q: Что такое Smali?

**A:** Smali - это человекочитаемая форма байткода Dalvik/ART (виртуальной машины Android). Это аналог ассемблера для Android приложений.

## Проблемы и решения

### Q: APK не устанавливается: "Package signature verification failed"

**A:** Проблема с подписью APK. Решение:
```bash
# Убедитесь что используется apksigner (не jarsigner)
apksigner sign --ks release.keystore --out signed.apk unsigned.apk

# Проверьте подпись
apksigner verify --verbose signed.apk
```

Для Android 11+ требуется V2/V3 подпись схема, jarsigner создает только V1.

### Q: Приложение крашится при запуске

**A:** Возможные причины:
1. **Некорректный патч native библиотеки** - откатите патчи и примените заново
2. **Ошибки в Smali синтаксисе** - проверьте логи: `adb logcat | grep -i VerifyError`
3. **Конфликт в AndroidManifest** - убедитесь что только одна activity имеет LAUNCHER intent-filter

Диагностика:
```bash
# Посмотреть точную причину краша
adb logcat | grep -i "AndroidRuntime\|FATAL"
```

### Q: Приложение работает, но не загружает контент

**A:** Проблема с расшифровкой `burriEnc`. Это означает что патч затронул критические функции расшифровки. Решение:
1. Проверьте что функции AES/XTS не были изменены
2. Используйте более точный метод патчинга (Ghidra)
3. Патчите только функции `check` и `licence`

### Q: Автообновления не работают после патча

**A:** Возможные причины:
1. Метод `update()` был случайно пропатчен
2. Сервер требует авторизацию

Проверка:
```bash
# Найти метод update в Smali
find decompiled -name "*.smali" -exec grep -A 10 "method.*update" {} \;

# Должен быть нативный вызов, не const/return
```

### Q: LoginActivity все еще показывается

**A:** Проверьте AndroidManifest.xml:
```bash
cat decompiled/AndroidManifest.xml | grep -A 5 "LAUNCHER"

# Должно быть только в MainActivity, не в LoginActivity
```

Если не помогло, проверьте что LoginActivity.smali пропатчен:
```bash
cat decompiled/smali*/com/eternal/xdsdk/LoginActivity.smali | grep "MainActivity"

# Должен быть вызов Intent к MainActivity
```

### Q: "apktool: command not found"

**A:** Установите apktool:
```bash
wget https://raw.githubusercontent.com/iBotPeaches/Apktool/master/scripts/linux/apktool -O /tmp/apktool
wget https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar -O /tmp/apktool.jar
sudo mv /tmp/apktool /usr/local/bin/
sudo mv /tmp/apktool.jar /usr/local/bin/
sudo chmod +x /usr/local/bin/apktool
```

### Q: Ошибка декомпиляции: "brut.androlib.AndrolibException"

**A:** Попробуйте:
```bash
# Вариант 1: обновить apktool до последней версии
# Вариант 2: декомпилировать без ресурсов
apktool d app.apk -o decompiled --no-res

# Вариант 3: форсировать декомпиляцию
apktool d app.apk -o decompiled -f
```

## Продвинутые вопросы

### Q: Как найти точные офсеты функций для патчинга?

**A:** Используйте Ghidra:
1. Импортируйте `libclient.so`
2. Дождитесь автоанализа
3. Window → Symbol Tree
4. Найдите функцию (например, `Java_com_eternal_xdsdk_SuperJNI_00024Companion_check`)
5. Кликните на функцию
6. В Listing window адрес будет показан (например, `00012340`)
7. File offset можно получить через: Navigation → Go To → File Offset

### Q: Можно ли автоматизировать патчинг в CI/CD?

**A:** Да, см. `docs/WORKFLOW.md` раздел "Автоматизация". Пример:
```yaml
# .github/workflows/patch.yml
name: Patch APK
on: [push]
jobs:
  patch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y default-jdk
      - name: Patch APK
        run: ./scripts/full_pipeline.sh app.apk
      - name: Upload artifact
        uses: actions/upload-artifact@v2
        with:
          name: patched-apk
          path: app-patched.apk
```

### Q: Как перехватить сетевые запросы для анализа?

**A:** Используйте mitmproxy:
```bash
# 1. Установить
pip3 install mitmproxy

# 2. Запустить
mitmweb -p 8080

# 3. Настроить Android устройство
# Settings → Wi-Fi → Modify Network → Proxy: Manual
# Host: <IP компьютера>, Port: 8080

# 4. Установить сертификат
adb push ~/.mitmproxy/mitmproxy-ca-cert.cer /sdcard/
# Settings → Security → Install certificate from storage

# 5. Запустить приложение и смотреть запросы в браузере: http://127.0.0.1:8081
```

### Q: Как обновить патч при выходе новой версии приложения?

**A:** Процесс тот же:
1. Скачайте новый APK
2. Запустите `./scripts/full_pipeline.sh new_app.apk`
3. Если структура сильно изменилась, может потребоваться ручной анализ

**Совет:** Сохраняйте заметки о том, какие функции были пропатчены, чтобы быстрее найти их в новой версии.

### Q: Можно ли применить патч к signed APK из Google Play?

**A:** Да, но:
1. Старая подпись будет удалена
2. APK будет подписан вашим keystore
3. Автообновления из Google Play перестанут работать (разные подписи)
4. Потребуется переустановка (не обновление)

### Q: Как добавить поддержку других архитектур (ARM32, x86)?

**A:** Для каждой архитектуры нужны свои патчи:

**ARM32 (armeabi-v7a):**
```asm
MOVS R0, #1    ; 01 20
BX LR          ; 70 47
```
Hex: `01 20 70 47`

**x86:**
```asm
MOV EAX, 1     ; B8 01 00 00 00
RET            ; C3
```
Hex: `B8 01 00 00 00 C3`

**x86_64:**
```asm
MOV EAX, 1     ; B8 01 00 00 00
RET            ; C3
```
Hex: `B8 01 00 00 00 C3`

Модифицируйте `scripts/patch_native.sh` для поддержки разных архитектур.

## Юридические вопросы

### Q: Это легально?

**A:** Зависит от юрисдикции и обстоятельств:
- ✓ Модификация собственного приложения - обычно легально
- ✓ Исследование безопасности (security research) - легально в большинстве стран
- ✗ Обход DRM для пиратства - нелегально
- ✗ Распространение пропатченных версий коммерческих приложений - нарушение авторских прав

**Рекомендация:** Используйте только для собственных приложений или с явного разрешения правообладателя.

### Q: Можно ли использовать в коммерческих целях?

**A:** Если вы владелец приложения - да. Если нет - проконсультируйтесь с юристом.

### Q: Нужно ли указывать авторство при распространении?

**A:** Скрипты в этом репозитории можно использовать свободно. Однако не забывайте о правах на само приложение.

## Вклад и поддержка

### Q: Как сообщить об ошибке?

**A:** Создайте Issue в репозитории с:
- Описанием проблемы
- Версией Android
- Логами (`adb logcat`)
- Шагами для воспроизведения

### Q: Могу ли я внести свой вклад?

**A:** Да! Pull requests приветствуются:
- Улучшения скриптов
- Поддержка новых архитектур
- Исправления ошибок
- Дополнения к документации

### Q: Где получить дополнительную помощь?

**A:** 
1. Прочитайте `docs/TECHNICAL.md` для технических деталей
2. Изучите `docs/WORKFLOW.md` для пошаговых инструкций
3. Проверьте Issues в репозитории - возможно, ваша проблема уже решена
